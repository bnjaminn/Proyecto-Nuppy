{% load static %}
<!-- 
    =========================================
    Permite a los usuarios autenticarse en el sistema.
    Valida credenciales (correo y contraseña) contra MongoDB.
    Si el usuario ya tiene sesión activa, muestra opciones para ir al home o cerrar sesión.
-->
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pagina inicio (login)</title>
    <link rel="icon" type="image/png" href="{% static 'prueba/img/Nuam.png' %}">
    <link rel="stylesheet" href="{% static 'prueba/css/login.css' %}">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    
    <!-- Script inline para cargar tema oscuro ANTES de renderizar (previene flash) -->
    <script>
        (function() {
            const temaOscuro = localStorage.getItem('temaOscuro') === 'true';
            if (temaOscuro) {
                document.documentElement.classList.add('dark-theme');
                document.body.classList.add('dark-theme');
            }
        })();
    </script>
    
    <!-- Script para cargar tema oscuro -->
    <script src="{% static 'prueba/js/tema.js' %}"></script>
</head>
<body>

    <!-- CONTENEDOR DEL FORMULARIO DE LOGIN
         ===================================
         Contiene el logo de la empresa y el formulario de autenticación
    -->
    <div class="login-container">
        <!-- Logo de la empresa -->
        <div class="logo-container">
            <img src="{% static 'prueba/img/Nuam.png' %}" alt="NUAM Logo" class="nuam-logo">
        </div>

        <!-- VERIFICACIÓN DE SESIÓN ACTIVA
             ==============================
             Si el usuario ya está autenticado, muestra opciones para navegar.
             Si no, muestra el formulario de login.
        -->
        {% if request.session.user_id %}
            <p>Ya estás logueado como: {{ request.session.user_nombre }}</p>
            <a href="{% url 'home' %}">Ir al Home</a> | 
            <a href="{% url 'logout' %}">Cerrar Sesión</a>
        
        {% else %}
            <form method="post">
                {% csrf_token %}
                
                {{ form.correo }}
                {{ form.contrasena }}
                
                {% if error %}
                    <p class="error-message">{{ error }}</p>
                {% endif %}
                    
                <button type="submit" class="login-button">Iniciar sesion</button>
            </form>
            
            <a href="{% url 'contacto' %}" class="contact-link">contacto</a>
        
        {% endif %}
    </div>

</body>
</html>